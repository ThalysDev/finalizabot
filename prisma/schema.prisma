// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./prisma/dev.db"
}

model Player {
  id            String              @id @default(cuid())
  sofascoreId   String              @unique
  name          String
  position      String
  sofascoreUrl  String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  
  matchStats    PlayerMatchStats[]
  marketAnalyses MarketAnalysis[]
  
  @@map("players")
}

model Match {
  id            String              @id @default(cuid())
  homeTeam      String
  awayTeam      String
  competition   String
  kickoffAt     DateTime
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  
  playerStats   PlayerMatchStats[]
  marketAnalyses MarketAnalysis[]
  
  @@map("matches")
}

model PlayerMatchStats {
  id            String    @id @default(cuid())
  playerId      String
  matchId       String?
  matchDate     DateTime
  minutesPlayed Int
  shots         Int
  createdAt     DateTime  @default(now())
  
  player        Player    @relation(fields: [playerId], references: [id], onDelete: Cascade)
  match         Match?    @relation(fields: [matchId], references: [id], onDelete: SetNull)
  
  @@index([playerId, matchDate(sort: Desc)])
  @@map("player_match_stats")
}

model MarketAnalysis {
  id               String    @id @default(cuid())
  playerId         String
  matchId          String
  marketType       String    // "SHOTS", "GOALS", etc.
  line             Float
  odds             Float
  u5Hits           Int
  u10Hits          Int
  cv               Float?
  shotsSeries      Json      // array de ints
  minutesSeries    Json      // array de ints
  createdAt        DateTime  @default(now())
  sourceUpdatedAt  DateTime?
  
  player           Player    @relation(fields: [playerId], references: [id], onDelete: Cascade)
  match            Match     @relation(fields: [matchId], references: [id], onDelete: Cascade)
  
  @@index([matchId])
  @@index([playerId])
  @@map("market_analyses")
}
