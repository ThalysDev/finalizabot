generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Player {
  id            String              @id @default(cuid())
  sofascoreId   String              @unique
  name          String
  position      String
  sofascoreUrl  String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  matchStats    PlayerMatchStats[]
  marketAnalyses MarketAnalysis[]
  favoritedBy   UserFavorite[]
}

model Match {
  id            String              @id @default(cuid())
  sofascoreId   String              @unique
  homeTeam      String
  awayTeam      String
  competition   String
  matchDate     DateTime
  status        String              @default("scheduled")
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  playerStats   PlayerMatchStats[]
  marketAnalyses MarketAnalysis[]
}

model PlayerMatchStats {
  id          String   @id @default(cuid())
  playerId    String
  matchId     String
  goals       Int      @default(0)
  assists     Int      @default(0)
  shots       Int      @default(0)
  shotsOnTarget Int    @default(0)
  minutesPlayed Int    @default(0)
  rating      Float?
  createdAt   DateTime @default(now())

  player      Player   @relation(fields: [playerId], references: [id])
  match       Match    @relation(fields: [matchId], references: [id])

  @@unique([playerId, matchId])
}

model MarketAnalysis {
  id          String   @id @default(cuid())
  playerId    String
  matchId     String
  market      String
  odds        Float
  probability Float
  confidence  Float
  recommendation String
  reasoning   String
  createdAt   DateTime @default(now())

  player      Player   @relation(fields: [playerId], references: [id])
  match       Match    @relation(fields: [matchId], references: [id])
}

// ============================================================================
// USER & SUBSCRIPTION — Preparado para integração com Clerk + Stripe
// ============================================================================

model User {
  id            String         @id @default(cuid())
  clerkId       String         @unique
  email         String         @unique
  name          String?
  tier          UserTier       @default(FREE)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  subscription  Subscription?
  favorites     UserFavorite[]
  alertSettings AlertSettings?
}

model Subscription {
  id              String             @id @default(cuid())
  userId          String             @unique
  plan            SubscriptionPlan   @default(PRO_MONTHLY)
  status          SubscriptionStatus @default(ACTIVE)
  stripeCustomerId    String?        @unique
  stripeSubscriptionId String?       @unique
  stripePriceId   String?
  currentPeriodStart DateTime?
  currentPeriodEnd   DateTime?
  cancelAtPeriodEnd  Boolean        @default(false)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt

  user            User               @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UserFavorite {
  id        String   @id @default(cuid())
  userId    String
  playerId  String
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  player    Player   @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([userId, playerId])
}

model AlertSettings {
  id            String   @id @default(cuid())
  userId        String   @unique
  pushEnabled   Boolean  @default(true)
  emailEnabled  Boolean  @default(false)
  silentMode    Boolean  @default(false)
  minRoi        Float    @default(10)
  maxCv         Float    @default(0.5)
  leagues       String[] @default(["Premier League", "La Liga", "Champions League"])
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// ============================================================================
// ENUMS
// ============================================================================

enum UserTier {
  FREE
  PRO
}

enum SubscriptionPlan {
  PRO_MONTHLY
  PRO_ANNUAL
}

enum SubscriptionStatus {
  ACTIVE
  PAST_DUE
  CANCELED
  INCOMPLETE
}

// ============================================================================
// ETL (sofascore-etl) — dados agora consumidos via HTTP API
// Ver: src/lib/etl/client.ts
// ============================================================================